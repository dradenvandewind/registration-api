\doxysection{email\+\_\+service.\+py}
\label{email__service_8py_source}\index{app/services/email\_service.py@{app/services/email\_service.py}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{keyword}{import}\ httpx}
\DoxyCodeLine{00002\ \textcolor{keyword}{from}\ app.core.config\ \textcolor{keyword}{import}\ settings}
\DoxyCodeLine{00003\ \textcolor{keyword}{from}\ typing\ \textcolor{keyword}{import}\ Optional}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{keyword}{class\ }EmailService:}
\DoxyCodeLine{00006\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self):}
\DoxyCodeLine{00007\ \ \ \ \ \ \ \ \ self.api\_url\ =\ settings.smtp\_api\_url}
\DoxyCodeLine{00008\ \ \ \ \ \ \ \ \ self.client:\ Optional[httpx.AsyncClient]\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{async\ def\ }\_\_aenter\_\_(self):}
\DoxyCodeLine{00011\ \ \ \ \ \ \ \ \ self.client\ =\ httpx.AsyncClient()}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keyword}{async\ def\ }\_\_aexit\_\_(self,\ exc\_type,\ exc\_val,\ exc\_tb):}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.client:}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \ \ \ \ await\ self.client.aclose()}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{async\ def\ }send\_activation\_code(self,\ email:\ str,\ code:\ str)\ -\/>\ bool:}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00020\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Send\ activation\ code\ via\ third-\/party\ email\ service}}
\DoxyCodeLine{00021\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Mock\ implementation\ -\/\ in\ production\ this\ would\ call\ actual\ SMTP\ API}}
\DoxyCodeLine{00022\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Mock\ API\ call\ to\ email\ service}}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ In\ production,\ this\ would\ be\ a\ real\ HTTP\ request}}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}ðŸ“§\ Sending\ activation\ code\ \{code\}\ to\ \{email\}"{}})}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Simulate\ API\ call}}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keyword}{with}\ self.client\ \textcolor{keywordflow}{or}\ httpx.AsyncClient()\ \textcolor{keyword}{as}\ client:}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response\ =\ await\ client.post(}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.api\_url,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ json=\{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}to"{}}:\ email,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}subject"{}}:\ \textcolor{stringliteral}{"{}Your\ activation\ code"{}},}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}body"{}}:\ f\textcolor{stringliteral}{"{}Your\ activation\ code\ is:\ \{code\}"{}}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \},}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ timeout=10.0}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ response.raise\_for\_status()}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{True}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{"{}Failed\ to\ send\ email:\ \{e\}"{}})}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ In\ production,\ we\ might\ want\ to\ retry\ or\ log\ to\ a\ dead\ letter\ queue}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{False}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{\#\ Singleton\ instance}}
\DoxyCodeLine{00048\ email\_service\ =\ EmailService()}

\end{DoxyCode}
